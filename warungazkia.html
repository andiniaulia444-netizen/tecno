<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warung Azkia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #ccfbf1 100%);
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        .glass-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .product-card {
            background: white;
            border-radius: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .floating-cart {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 50;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .floating-cart:hover {
            transform: scale(1.05);
        }

        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            font-size: 0.7rem;
            font-weight: bold;
            min-width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            padding: 0 6px;
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        #cartModal {
            position: fixed;
            inset: 0;
            z-index: 99;
            display: none;
        }

        #cartModal.show {
            display: block;
        }

        #cartModal.show .cart-overlay {
            opacity: 1;
        }

        #cartModal.show .cart-panel {
            transform: translateY(0);
        }

        .cart-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .cart-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 24px 24px 0 0;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .notification-panel {
            transform: translateY(-20px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .notification-panel.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        .category-scroll {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .category-scroll::-webkit-scrollbar {
            display: none;
        }

        .popular-scroll {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            display: flex;
            gap: 12px;
            padding-bottom: 8px;
        }
        .popular-scroll::-webkit-scrollbar {
            display: none;
        }

        .popular-item {
            min-width: 160px;
            flex-shrink: 0;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .category-chip {
            white-space: nowrap;
            padding: 10px 18px;
            border-radius: 24px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .category-chip.active {
            background: #10b981;
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        .category-chip:not(.active) {
            background: white;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }
        .category-chip:not(.active):hover {
            background: #ecfdf5;
            border-color: #10b981;
            color: #10b981;
        }

        .product-detail-page {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #f0fdf4 0%, #ccfbf1 100%);
            z-index: 60;
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }
        .product-detail-page.active {
            transform: translateX(0);
        }

        .qty-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 70;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .qty-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .qty-modal-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 24px 24px 0 0;
            padding: 24px;
            z-index: 71;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .qty-modal-panel.active {
            transform: translateY(0);
        }

        .address-input {
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        .address-input:focus {
            border-color: #10b981;
            outline: none;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .back-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 6px 14px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
            border: none;
            cursor: pointer;
        }
        .back-btn:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        .back-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="text-gray-800">

    <nav class="glass-nav fixed top-0 w-full z-40 px-4 py-2.5 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="w-9 h-9 bg-gradient-to-br from-emerald-500 to-emerald-700 rounded-xl flex items-center justify-center text-white font-bold text-base shadow-lg shadow-emerald-200">
                <i class="fa-solid fa-leaf"></i>
            </div>
            <h1 class="text-lg font-bold text-emerald-900 tracking-tight">Warung Azkia</h1>
        </div>
        <div class="relative">
            <button onclick="toggleNotifications()" class="text-emerald-700 hover:text-emerald-900 transition-colors p-2 relative">
                <i class="fa-regular fa-bell text-lg"></i>
                <span id="notifBadge" class="absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white hidden"></span>
            </button>
            <div id="notificationPanel" class="notification-panel absolute right-0 top-10 w-72 bg-white rounded-2xl shadow-2xl border border-gray-100 overflow-hidden z-50">
                <div class="p-3 bg-emerald-50 border-b border-emerald-100 flex justify-between items-center">
                    <h3 class="font-bold text-emerald-900 text-sm">Notifikasi</h3>
                    <button onclick="clearNotifications()" class="text-xs text-emerald-600 hover:underline">Hapus Semua</button>
                </div>
                <div id="notificationList" class="max-h-56 overflow-y-auto custom-scroll">
                    <div class="p-4 text-center text-gray-400 text-sm">Belum ada notifikasi</div>
                </div>
            </div>
        </div>
    </nav>

    <main class="pt-16 px-3 max-w-2xl mx-auto">
        <div class="w-full aspect-video rounded-2xl overflow-hidden shadow-lg mb-3 relative group">
            <img src="https://image.qwenlm.ai/public_source/c202b2a9-e670-4cdf-b543-855c1369c30b/100554ab9-2680-4697-9154-0bc7c946ee3d.png" alt="Warung Azkia Poster" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
            <div class="absolute inset-0 bg-gradient-to-t from-emerald-900/60 to-transparent flex items-end p-6">
                <div>
                    <h2 class="text-white text-2xl font-bold">Belanja Segar & Hemat</h2>
                    <p class="text-emerald-100 text-sm">Kebutuhan harian terbaik untuk keluarga Anda</p>
                </div>
            </div>
        </div>

        <div class="relative mb-3">
            <input type="text" id="searchInput" placeholder="Cari beras, minyak, gula, susu..." class="w-full pl-12 pr-4 py-4 rounded-xl border-none shadow-md focus:ring-2 focus:ring-emerald-500 focus:outline-none bg-white text-gray-700 placeholder-gray-400 text-base">
            <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-base"></i>
        </div>

        <div class="category-scroll flex gap-2 mb-3 pb-2">
            <button onclick="filterByCategory('all')" class="category-chip" data-category="all"><i class="fa-solid fa-layer-group mr-1"></i> Semua</button>
            <button onclick="filterByCategory('makanan-pokok')" class="category-chip" data-category="makanan-pokok"><i class="fa-solid fa-bowl-rice mr-1"></i> Makanan Pokok</button>
            <button onclick="filterByCategory('makanan-ringan')" class="category-chip" data-category="makanan-ringan"><i class="fa-solid fa-cookie mr-1"></i> Makanan Ringan</button>
            <button onclick="filterByCategory('makanan-berat')" class="category-chip" data-category="makanan-berat"><i class="fa-solid fa-utensils mr-1"></i> Makanan Berat</button>
            <button onclick="filterByCategory('minuman')" class="category-chip" data-category="minuman"><i class="fa-solid fa-glass-water mr-1"></i> Minuman</button>
            <button onclick="filterByCategory('bumbu-dapur')" class="category-chip" data-category="bumbu-dapur"><i class="fa-solid fa-pepper-hot mr-1"></i> Bumbu Dapur</button>
            <button onclick="filterByCategory('kebutuhan-pokok')" class="category-chip" data-category="kebutuhan-pokok"><i class="fa-solid fa-house-chimney mr-1"></i> Kebutuhan Pokok</button>
        </div>

        <div class="mb-3">
            <h3 class="text-base font-bold text-emerald-900 mb-2 flex items-center gap-1.5"><i class="fa-solid fa-fire text-orange-500 text-sm"></i> Produk Populer <span id="popularCategoryLabel" class="text-xs font-normal text-emerald-600 bg-emerald-100 px-2 py-0.5 rounded-full ml-2">Semua</span></h3>
            <div id="popularProducts" class="popular-scroll"></div>
        </div>

        <div>
            <h3 class="text-base font-bold text-emerald-900 mb-2 flex items-center gap-1.5"><i class="fa-solid fa-store text-emerald-600 text-sm"></i> Semua Produk</h3>
            <div id="productGrid" class="grid grid-cols-2 gap-3 pb-20"></div>
        </div>
    </main>

    <button onclick="openCart()" class="floating-cart bg-gradient-to-br from-emerald-500 to-emerald-700 text-white w-14 h-14 rounded-full shadow-xl flex items-center justify-center hover:shadow-2xl focus:outline-none group">
        <i class="fa-solid fa-cart-shopping text-xl group-hover:scale-110 transition-transform"></i>
        <div id="cartCountBadge" class="cart-badge hidden">0</div>
    </button>

    <div id="qtyModalOverlay" class="qty-modal-overlay" onclick="closeQtyModal()"></div>
    <div id="qtyModalPanel" class="qty-modal-panel">
        <div class="w-10 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
        <div class="flex items-center gap-3 mb-4">
            <img id="qtyProductImage" src="" alt="Product" class="w-14 h-14 object-contain bg-gray-50 rounded-lg">
            <div class="flex-1">
                <h3 id="qtyProductName" class="font-bold text-gray-800 text-sm">Product Name</h3>
                <p id="qtyProductPrice" class="text-emerald-600 font-bold text-xs">Rp 0</p>
            </div>
        </div>
        <h4 class="text-base font-bold text-gray-800 mb-4 text-center">Berapa banyak?</h4>
        <div class="flex items-center justify-center gap-6 mb-6">
            <button onclick="adjustQty(-1)" class="w-12 h-12 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 flex items-center justify-center text-lg font-bold transition-colors"><i class="fa-solid fa-minus"></i></button>
            <span id="qtyInput" class="text-3xl font-bold text-emerald-700 w-12 text-center">1</span>
            <button onclick="adjustQty(1)" class="w-12 h-12 rounded-full bg-emerald-100 text-emerald-600 hover:bg-emerald-200 flex items-center justify-center text-lg font-bold transition-colors"><i class="fa-solid fa-plus"></i></button>
        </div>
        <button onclick="confirmAddToCart()" class="w-full btn-primary py-3.5 rounded-xl font-bold text-base shadow-lg flex items-center justify-center gap-2"><i class="fa-solid fa-cart-plus"></i> Tambahkan ke Keranjang</button>
    </div>

    <div id="productDetailPage" class="product-detail-page">
        <div class="min-h-screen flex flex-col">
            <div class="sticky top-0 bg-white/95 backdrop-blur z-10 px-4 py-2.5 flex items-center gap-3 border-b border-gray-100">
                <button onclick="closeProductDetail()" class="w-9 h-9 bg-gray-100 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-200 transition-colors"><i class="fa-solid fa-arrow-left text-sm"></i></button>
                <h2 class="font-bold text-base text-emerald-900">Detail Produk</h2>
            </div>
            <div class="flex-1 p-3">
                <div class="bg-white rounded-xl p-4 mb-3 shadow-sm">
                    <div class="aspect-square bg-gray-50 rounded-lg flex items-center justify-center p-4 mb-4">
                        <img id="detailImage" src="" alt="Product" class="w-full h-full object-contain">
                    </div>
                    <h1 id="detailName" class="text-xl font-bold text-gray-900 mb-1">Product Name</h1>
                    <p id="detailPrice" class="text-xl font-bold text-emerald-600 mb-3">Rp 0</p>
                    <p id="detailDesc" class="text-gray-500 leading-relaxed mb-4 text-sm">Description</p>
                    <div class="flex items-center gap-4 p-4 bg-emerald-50 rounded-xl mb-4">
                        <div class="w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-600"><i class="fa-solid fa-truck-fast"></i></div>
                        <div>
                            <p class="font-semibold text-emerald-900 text-sm">Pengiriman Cepat</p>
                            <p class="text-xs text-emerald-600">Pesanan diproses dalam 1 jam</p>
                        </div>
                    </div>
                </div>
                <button onclick="showQtyModalFromDetail()" class="w-full btn-primary py-3.5 rounded-xl font-bold text-base shadow-lg flex items-center justify-center gap-2"><i class="fa-solid fa-cart-plus"></i> Masukan ke Keranjang</button>
            </div>
        </div>
    </div>

    <div id="cartModal">
        <div class="cart-overlay" onclick="closeCartModal()"></div>
        <div class="cart-panel">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-emerald-50 rounded-t-3xl flex-shrink-0">
                <button class="back-btn" onclick="closeCartModal()"><i class="fa-solid fa-arrow-left text-xs"></i> Kembali</button>
                <h2 class="text-lg font-bold text-emerald-900">Keranjang</h2>
                <div class="w-16"></div>
            </div>
            <div id="cartItemsContainer" class="flex-1 overflow-y-auto p-4 custom-scroll space-y-3">
                <div class="text-center text-gray-400 mt-10 flex flex-col items-center">
                    <i class="fa-solid fa-basket-shopping text-4xl mb-3 opacity-30"></i>
                    <p class="font-medium text-sm">Keranjang kosong</p>
                    <p class="text-xs">Yuk belanja kebutuhanmu!</p>
                </div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-gray-50 flex-shrink-0">
                <label class="block text-sm font-bold text-gray-700 mb-2"><i class="fa-solid fa-location-dot text-emerald-600 mr-1"></i> Alamat Pengiriman</label>
                <textarea id="addressInput" placeholder="Masukkan alamat lengkap..." class="address-input w-full p-3 rounded-xl text-sm resize-none bg-white" rows="3"></textarea>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white pb-6 flex-shrink-0">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-gray-500 text-sm">Total Pembayaran</span>
                    <span id="cartTotal" class="text-xl font-bold text-emerald-700">Rp 0</span>
                </div>
                <button onclick="checkoutWhatsApp()" class="w-full bg-gradient-to-r from-emerald-500 to-emerald-700 text-white py-3.5 rounded-xl font-bold text-base shadow-lg hover:shadow-xl active:scale-95 transition-all flex items-center justify-center gap-2"><i class="fa-brands fa-whatsapp text-lg"></i> Beli Sekarang</button>
            </div>
        </div>
    </div>

    <script>
        const products = [
            { id: 1, name: "Beras Premium 5kg", desc: "Beras putih pulen pilihan", price: 65000, image: "https://image.qwenlm.ai/public_source/c202b2a9-e670-4cdf-b543-855c1369c30b/10fe0ee14-6ca5-48c0-b623-2d04f80dfca6.png", category: "makanan-pokok", popular: true },
            { id: 2, name: "Minyak Goreng 2L", desc: "Minyak goreng sawit jernih", price: 42000, image: "https://image.qwenlm.ai/public_source/c202b2a9-e670-4cdf-b543-855c1369c30b/1e5f82e52-6527-4aee-8f98-af9e6ad018db.png", category: "kebutuhan-pokok", popular: true },
            { id: 3, name: "Gula Pasir 1kg", desc: "Gula pasir putih murni", price: 14500, image: "https://image.qwenlm.ai/public_source/c202b2a9-e670-4cdf-b543-855c1369c30b/15986b6be-2e7f-422d-a82a-6efe71e4ea4e.png", category: "makanan-pokok", popular: true },
            { id: 4, name: "Mie Instan Goreng", desc: "Mie instan rasa ayam bawang", price: 3500, image: "https://image.qwenlm.ai/public_source/c202b2a9-e670-4cdf-b543-855c1369c30b/170f62c6a-c1f8-4324-a582-13bc5acec40f.png", category: "makanan-berat", popular: true },
            { id: 5, name: "Susu UHT Full Cream", desc: "Susu segar 1 Liter", price: 18000, image: "https://image.qwenlm.ai/public_source/c202b2a9-e670-4cdf-b543-855c1369c30b/15ceb3541-5fc9-4c91-b89b-1fe8b4efcf2a.png", category: "minuman", popular: true },
            { id: 6, name: "Kecap Manis 600ml", desc: "Kecap manis kental istimewa", price: 22000, image: "https://image.qwenlm.ai/public_source/c202b2a9-e670-4cdf-b543-855c1369c30b/150c98a31-acb0-4ddc-ba8e-add1c46d45c1.png", category: "bumbu-dapur", popular: true },
            { id: 7, name: "Keripik Singkong", desc: "Keripik singkong renyah", price: 12000, image: "https://image.qwenlm.ai/public_source/c202b2a9-e670-4cdf-b543-855c1369c30b/12e466ee5-ccc6-45f2-8004-2eb5e756912a.png", category: "makanan-ringan", popular: true },
            { id: 8, name: "Air Mineral 600ml", desc: "Air mineral murni", price: 4000, image: "https://image.qwenlm.ai/public_source/c202b2a9-e670-4cdf-b543-855c1369c30b/1772e83a3-4d22-4d05-9ffe-0b5462f9c55e.png", category: "minuman", popular: true },
            { id: 9, name: "Tepung Terigu 1kg", desc: "Tepung terigu protein sedang", price: 11000, image: "https://image.qwenlm.ai/public_source/c202b2a9-e670-4cdf-b543-855c1369c30b/1b221d0e9-635f-4ae9-8fbb-d8e675da9f4c.png", category: "makanan-pokok", popular: false },
            { id: 10, name: "Saus Sambal 300ml", desc: "Saus sambal pedas manis", price: 15000, image: "https://image.qwenlm.ai/public_source/c202b2a9-e670-4cdf-b543-855c1369c30b/1bc6c75c2-e6f4-4cf9-9d42-60c9e56d9df0.png", category: "bumbu-dapur", popular: true },
            { id: 11, name: "Kopi Instan 10 Sachet", desc: "Kopi instan 3 in 1", price: 18000, image: "https://image.qwenlm.ai/public_source/c202b2a9-e670-4cdf-b543-855c1369c30b/10c258b9f-f3f1-4140-8324-df75c075111b.png", category: "minuman", popular: true },
            { id: 12, name: "Sabun Cuci Piring", desc: "Sabun cuci piring efektif", price: 9000, image: "https://image.qwenlm.ai/public_source/c202b2a9-e670-4cdf-b543-855c1369c30b/1c05ea06a-7545-42db-a512-517751df1b4e.png", category: "kebutuhan-pokok", popular: true }
        ];

        let cart = {};
        let notifications = [];
        let currentProduct = null;
        let tempQty = 1;
        let currentCategory = 'all';
        const cartModal = document.getElementById('cartModal');
        const cartCountBadge = document.getElementById('cartCountBadge');

        document.addEventListener('DOMContentLoaded', () => {
            renderProducts(products);
            renderPopularProducts('all');
            refreshCartBadge();
            loadAddress();
        });

        function loadAddress() {
            const savedAddress = localStorage.getItem('warungAzkiaAddress');
            if (savedAddress) document.getElementById('addressInput').value = savedAddress;
        }

        function saveAddress() {
            const address = document.getElementById('addressInput').value.trim();
            localStorage.setItem('warungAzkiaAddress', address);
        }

        function filterByCategory(category) {
            currentCategory = category;
            document.querySelectorAll('.category-chip').forEach(chip => {
                chip.classList.remove('active');
                if (chip.dataset.category === category) chip.classList.add('active');
            });
            renderPopularProducts(category);
            let filtered = products;
            if (category !== 'all') filtered = products.filter(p => p.category === category);
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) filtered = filtered.filter(p => p.name.toLowerCase().includes(searchTerm));
            renderProducts(filtered);
        }

        function renderPopularProducts(category) {
            const container = document.getElementById('popularProducts');
            const label = document.getElementById('popularCategoryLabel');
            let popular = products.filter(p => p.popular);
            if (category !== 'all') popular = popular.filter(p => p.category === category);
            const categoryNames = { 'all': 'Semua', 'makanan-pokok': 'Makanan Pokok', 'makanan-ringan': 'Makanan Ringan', 'makanan-berat': 'Makanan Berat', 'minuman': 'Minuman', 'bumbu-dapur': 'Bumbu Dapur', 'kebutuhan-pokok': 'Kebutuhan Pokok' };
            label.textContent = categoryNames[category] || 'Semua';
            if (popular.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-sm py-4 px-2"><i class="fa-solid fa-circle-info mr-1"></i> Belum ada produk populer</div>';
                return;
            }
            container.innerHTML = popular.map(product => `<div onclick="openProductDetail(${product.id})" class="popular-item product-card"><div class="relative pt-[100%] overflow-hidden bg-gradient-to-br from-gray-50 to-emerald-50"><img src="${product.image}" class="absolute top-0 left-0 w-full h-full object-contain p-3"><div class="absolute top-2 right-2 bg-orange-500 text-white text-xs px-2 py-0.5 rounded-full"><i class="fa-solid fa-fire text-[10px]"></i></div></div><div class="p-3"><h3 class="font-bold text-gray-800 text-xs mb-1 line-clamp-1">${product.name}</h3><p class="font-bold text-emerald-700 text-sm">Rp ${product.price.toLocaleString('id-ID')}</p></div></div>`).join('');
        }

        function renderProducts(items) {
            const grid = document.getElementById('productGrid');
            if (items.length === 0) {
                grid.innerHTML = '<div class="col-span-2 text-center py-10 text-gray-400"><i class="fa-solid fa-magnifying-glass text-4xl mb-3"></i><p>Produk tidak ditemukan</p></div>';
                return;
            }
            grid.innerHTML = items.map(product => `<div onclick="openProductDetail(${product.id})" class="product-card flex flex-col h-full"><div class="relative pt-[100%] overflow-hidden bg-gradient-to-br from-gray-50 to-emerald-50"><img src="${product.image}" class="absolute top-0 left-0 w-full h-full object-contain p-4 hover:scale-110 transition-transform duration-500">${product.popular ? '<div class="absolute top-2 right-2 bg-orange-500 text-white text-[10px] px-1.5 py-0.5 rounded-full"><i class="fa-solid fa-fire"></i></div>' : ''}</div><div class="p-3 flex flex-col flex-1"><h3 class="font-bold text-gray-800 text-xs mb-1 line-clamp-1">${product.name}</h3><p class="text-xs text-gray-500 mb-2 line-clamp-2 flex-1">${product.desc}</p><div class="mt-auto"><div class="flex justify-between items-center mb-2"><span class="font-bold text-emerald-700 text-xs">Rp ${product.price.toLocaleString('id-ID')}</span></div><button onclick="event.stopPropagation(); showQtyModal(${product.id})" class="w-full bg-white border border-emerald-200 text-emerald-700 py-1.5 rounded-lg font-semibold text-xs hover:bg-emerald-50 hover:border-emerald-300 transition-all flex items-center justify-center gap-1.5"><i class="fa-solid fa-cart-shopping"></i> Keranjang</button></div></div></div>`).join('');
        }

        function openProductDetail(id) {
            currentProduct = products.find(p => p.id === id);
            document.getElementById('detailImage').src = currentProduct.image;
            document.getElementById('detailName').textContent = currentProduct.name;
            document.getElementById('detailPrice').textContent = "Rp " + currentProduct.price.toLocaleString('id-ID');
            document.getElementById('detailDesc').textContent = currentProduct.desc;
            document.getElementById('productDetailPage').classList.add('active');
        }

        function closeProductDetail() {
            document.getElementById('productDetailPage').classList.remove('active');
            currentProduct = null;
        }

        function showQtyModalFromDetail() {
            if (!currentProduct) return;
            showQtyModal(currentProduct.id);
        }

        function showQtyModal(productId) {
            currentProduct = products.find(p => p.id === productId);
            tempQty = 1;
            document.getElementById('qtyProductImage').src = currentProduct.image;
            document.getElementById('qtyProductName').textContent = currentProduct.name;
            document.getElementById('qtyProductPrice').textContent = "Rp " + currentProduct.price.toLocaleString('id-ID');
            document.getElementById('qtyInput').textContent = "1";
            document.getElementById('qtyModalOverlay').classList.add('active');
            document.getElementById('qtyModalPanel').classList.add('active');
        }

        function closeQtyModal() {
            document.getElementById('qtyModalOverlay').classList.remove('active');
            document.getElementById('qtyModalPanel').classList.remove('active');
            setTimeout(() => { currentProduct = null; tempQty = 1; }, 300);
        }

        function adjustQty(change) {
            tempQty += change;
            if (tempQty < 1) tempQty = 1;
            document.getElementById('qtyInput').textContent = tempQty;
        }

        function confirmAddToCart() {
            if (!currentProduct) return;
            const pid = currentProduct.id;
            if (!cart[pid]) cart[pid] = 0;
            cart[pid] += tempQty;
            refreshCartBadge();
            addNotification(`Berhasil menambahkan ${currentProduct.name} (${tempQty}x) ke keranjang`);
            closeQtyModal();
            const btn = document.querySelector('.floating-cart');
            btn.classList.add('scale-110');
            setTimeout(() => btn.classList.remove('scale-110'), 200);
        }

        function openCart() {
            cartModal.classList.add('show');
            renderCartItems();
        }

        function closeCartModal() {
            cartModal.classList.remove('show');
            saveAddress();
        }

        function getTotalCartItems() {
            let total = 0;
            for (const productId in cart) total += cart[productId];
            return total;
        }

        function refreshCartBadge() {
            const totalItems = getTotalCartItems();
            if (totalItems > 0) {
                cartCountBadge.textContent = totalItems > 9 ? '9+' : totalItems;
                cartCountBadge.classList.remove('hidden');
            } else {
                cartCountBadge.classList.add('hidden');
            }
        }

        function renderCartItems() {
            const container = document.getElementById('cartItemsContainer');
            const totalEl = document.getElementById('cartTotal');
            const productIds = Object.keys(cart);
            if (productIds.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 mt-10 flex flex-col items-center"><i class="fa-solid fa-basket-shopping text-4xl mb-3 opacity-30"></i><p class="font-medium text-sm">Keranjang kosong</p><p class="text-xs">Yuk belanja kebutuhanmu!</p></div>';
                totalEl.textContent = "Rp 0";
                return;
            }
            let total = 0;
            let html = '';
            productIds.forEach(id => {
                const product = products.find(p => p.id == id);
                const qty = cart[id];
                const subtotal = product.price * qty;
                total += subtotal;
                html += `<div class="flex gap-3 bg-white p-2.5 rounded-xl border border-gray-100 shadow-sm"><img src="${product.image}" class="w-16 h-16 object-contain bg-gray-50 rounded-lg"><div class="flex-1 flex flex-col justify-between"><div><h4 class="font-bold text-gray-800 text-xs line-clamp-1">${product.name}</h4><p class="text-xs text-gray-500">Rp ${product.price.toLocaleString('id-ID')}</p></div><div class="flex justify-between items-center mt-2"><div class="flex items-center gap-2 bg-gray-50 rounded-lg px-2 py-1"><button onclick="updateCartQuantity(${product.id}, -1)" class="w-5 h-5 flex items-center justify-center text-gray-500 hover:text-emerald-600"><i class="fa-solid fa-minus text-xs"></i></button><span class="text-xs font-bold text-gray-700 w-4 text-center">${qty}</span><button onclick="updateCartQuantity(${product.id}, 1)" class="w-5 h-5 flex items-center justify-center text-gray-500 hover:text-emerald-600"><i class="fa-solid fa-plus text-xs"></i></button></div><button onclick="removeFromCart(${product.id})" class="text-red-400 hover:text-red-600 p-1"><i class="fa-solid fa-trash-can text-sm"></i></button></div></div></div>`;
            });
            container.innerHTML = html;
            totalEl.textContent = "Rp " + total.toLocaleString('id-ID');
        }

        function updateCartQuantity(productId, change) {
            if (!cart[productId]) return;
            cart[productId] += change;
            if (cart[productId] <= 0) delete cart[productId];
            refreshCartBadge();
            renderCartItems();
        }

        function removeFromCart(productId) {
            delete cart[productId];
            refreshCartBadge();
            renderCartItems();
            addNotification("Produk dihapus dari keranjang");
        }

        function toggleNotifications() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('active');
            if (panel.classList.contains('active')) {
                renderNotifications();
                document.getElementById('notifBadge').classList.add('hidden');
            }
        }

        function addNotification(message) {
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            notifications.unshift({ message, time });
            document.getElementById('notifBadge').classList.remove('hidden');
        }

        function renderNotifications() {
            const list = document.getElementById('notificationList');
            if (notifications.length === 0) {
                list.innerHTML = '<div class="p-4 text-center text-gray-400 text-sm">Belum ada notifikasi</div>';
                return;
            }
            list.innerHTML = notifications.map(n => `<div class="p-3 border-b border-gray-50 hover:bg-gray-50 transition-colors flex gap-3 items-start"><div class="w-2 h-2 mt-1.5 rounded-full bg-emerald-500 flex-shrink-0"></div><div><p class="text-xs text-gray-800 font-medium">${n.message}</p><p class="text-xs text-gray-400 mt-0.5">${n.time}</p></div></div>`).join('');
        }

        function clearNotifications() {
            notifications = [];
            renderNotifications();
            document.getElementById('notifBadge').classList.add('hidden');
        }

        function checkoutWhatsApp() {
            const productIds = Object.keys(cart);
            if (productIds.length === 0) { alert("Keranjang belanja masih kosong!"); return; }
            const address = document.getElementById('addressInput').value.trim();
            if (!address) { alert("Mohon isi alamat pengiriman terlebih dahulu!"); return; }
            saveAddress();
            let message = "bi meser%0A%0A";
            let total = 0;
            productIds.forEach(id => {
                const product = products.find(p => p.id == id);
                const qty = cart[id];
                const subtotal = product.price * qty;
                total += subtotal;
                message += `- ${product.name} (${qty}x) : Rp ${subtotal.toLocaleString('id-ID')}%0A`;
            });
            message += `%0A*Total: Rp ${total.toLocaleString('id-ID')}*`;
            message += "%0A%0A";
            message += `*Alamat Pengiriman:*%0A${address.replace(/\n/g, '%0A')}`;
            message += "%0A%0Agewat nya bi rusuh ðŸ˜";
            const phone = "6282317018517";
            const url = `https://wa.me/${phone}?text=${message}`;
            addNotification("Belanjaan sedang diproses...");
            renderNotifications();
            setTimeout(() => {
                window.open(url, '_blank');
                cart = {};
                refreshCartBadge();
                closeCartModal();
            }, 1000);
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            let filtered = products;
            if (currentCategory !== 'all') filtered = products.filter(p => p.category === currentCategory);
            if (term) filtered = filtered.filter(p => p.name.toLowerCase().includes(term));
            renderProducts(filtered);
        });

        document.addEventListener('click', (e) => {
            const panel = document.getElementById('notificationPanel');
            const btn = e.target.closest('button');
            if (!panel.contains(e.target) && !btn?.onclick?.toString().includes('toggleNotifications')) {
                panel.classList.remove('active');
            }
        });
    </script>
</body>
</html>

